*filter

# Politiche di default
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# ---------------------------
# Accesso base e sicurezza
# ---------------------------

# Traffico localhost
-A INPUT -i lo -j ACCEPT

# Connessioni gi√† stabilite
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# ---------------------------
# Accesso SSH
# ---------------------------

# SSH da aziendale e VPN
-A INPUT -p tcp -s 10.10.1.0/24 --dport 22 -j ACCEPT
-A INPUT -p tcp -s 10.10.2.0/24 --dport 22 -j ACCEPT

# ---------------------------
# Accesso a servizi Zero Trust
# ---------------------------

# PEP (porta 8002) accessibile da:
-A INPUT -p tcp -s 10.10.1.0/24 --dport 8002 -j ACCEPT
-A INPUT -p tcp -s 10.10.2.0/24 --dport 8002 -j ACCEPT
-A INPUT -p tcp -s 10.10.3.0/24 --dport 8002 -j ACCEPT

# PDP accessibile solo da PEP
-A INPUT -p tcp -s 172.18.0.2 --dport 8001 -j ACCEPT

# Squid (3128) accessibile da reti fidate
-A INPUT -p tcp -s 10.10.1.0/24 --dport 3128 -j ACCEPT
-A INPUT -p tcp -s 10.10.2.0/24 --dport 3128 -j ACCEPT
-A INPUT -p tcp -s 10.10.3.0/24 --dport 3128 -j ACCEPT

# ---------------------------
# Protezione base da SYN flood
# ---------------------------
-A INPUT -p tcp --syn --dport 80 -m limit --limit 1/s --limit-burst 5 -j ACCEPT

# ---------------------------
# Logging e fallback
# ---------------------------

# Log dei pacchetti non gestiti
-A INPUT -j LOG --log-prefix "Blocked Packet: " --log-level 4

# Rifiuto finale
-A INPUT -j REJECT

COMMIT
