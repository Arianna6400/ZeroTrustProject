# ============================================
# Snort Local Rules - ZTA Security Policies
# ============================================

# === Minacce generiche e pattern noti ===

alert icmp any any -> any any (msg:"ICMP Packet Detected"; sid:1000001; rev:1; priority:3;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 80 (msg:"SQL Injection Attempt - UNION SELECT"; content:"union select"; sid:1000002; rev:1; priority:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg:"Suspicious HTTPS traffic"; flags: S; sid:1000003; rev:1; priority:2;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"FTP Buffer Overflow Attempt"; content:"USER"; sid:1000004; rev:1; priority:1;)
alert ip $EXTERNAL_NET any -> $HOME_NET any (msg:"Possible DDoS detected - Large packet size"; dsize:>1400; flow:to_server; sid:1000005; rev:1; priority:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 445 (msg:"MS SMB Vulnerability Exploit"; content:"|45 00 00 00|"; sid:1000006; rev:1; priority:1;)
alert tcp any any -> $HOME_NET any (msg:"TCP SYN Scan (port scan)"; flags:S; flow:stateless; sid:2000003; rev:1; priority:2;)
alert tcp any any -> $HOME_NET [81,9999,12345] (msg:"Accesso a porte sospette"; sid:2000004; rev:1; priority:2;)

# === Contesto ZTA - Regole di monitoraggio ===

# Accesso PEP da rete pubblica (non ammesso)
alert tcp [10.10.4.0/24] any -> $HOME_NET 8002 (msg:"Tentativo di accesso a PEP da rete pubblica"; sid:2000001; rev:1; priority:1;)

# Accesso diretto al PDP da host non autorizzato
alert tcp !$HOME_NET any -> $HOME_NET 8001 (msg:"Accesso PDP da fonte non autorizzata"; sid:2000002; rev:1; priority:1;)

# Accesso SSH da rete pubblica (non ammesso)
alert tcp [10.10.4.0/24] any -> $HOME_NET 22 (msg:"Tentativo SSH da rete pubblica"; sid:2000005; rev:1; priority:2;)

# ============================================
# Policy Zero Trust Enforcement (PDP Mirror)
# ============================================

# Scrittura verso risorsa sensibile da rete pubblica
alert tcp [10.10.4.0/24] any -> $HOME_NET 8002 (msg:"ZTA POLICY VIOLATION: Scrittura su risorsa sensibile da rete pubblica"; content:"scrittura"; nocase; sid:3000001; rev:1; priority:1;)

# POST sospetto da rete domestica (privato)
alert tcp [10.10.3.0/24] any -> $HOME_NET 8002 (msg:"ZTA WARNING: POST da rete domestica (possibile dispositivo privato)"; content:"POST"; http_method; sid:3000002; rev:1; priority:2;)

# Accesso PDP diretto non tramite PEP
alert tcp !$HOME_NET any -> $HOME_NET 8001 (msg:"ZTA POLICY VIOLATION: Accesso diretto al PDP non da PEP"; sid:3000003; rev:1; priority:1;)

# Accesso con ruolo sconosciuto
alert tcp any any -> $HOME_NET 8002 (msg:"ZTA RISK: Accesso da ruolo sconosciuto"; content:"sconosciuto"; nocase; sid:3000004; rev:1; priority:2;)
