# === 1. Porte proxy ===
http_port 3128
http_port 3129 intercept

# === 2. ACL per subnet ===
acl rete_aziendale src 10.10.1.0/24
acl rete_vpn src 10.10.2.0/24
acl rete_domestica src 10.10.3.0/24
acl rete_pubblica src 10.10.4.0/24

# === 3. ACL per porte sicure ===
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl Safe_ports port 8001
acl Safe_ports port 8002
acl CONNECT method CONNECT

# === 4. ACL per orario lavorativo (es. lun-ven 08:00-18:00) ===
acl orario_lavorativo time MTWHF 08:00-18:00
acl fuori_orario       time MTWHF 18:01-23:59
acl notte              time SMTWHFA 00:00-07:59

# === 5. ACL avanzate ===
acl metodo_post method POST
acl url_operazione url_regex -i /operazione
acl risorsa_sensibile url_regex -i Cartella.Clinica|Dati.Sanitari|Profilo.Biometrico
acl dispositivo_privato req_header X-Dispositivo privato
acl rete_pubblica_hdr req_header X-Rete pubblica

# === 6. POLICY DI SICUREZZA ===

# Blocca scrittura su risorse sensibili da rete pubblica o dispositivi privati
http_access deny rete_pubblica metodo_post risorsa_sensibile
http_access deny dispositivo_privato metodo_post risorsa_sensibile

# Blocca POST verso /operazione da rete pubblica
http_access deny rete_pubblica metodo_post url_operazione

# Consenti accesso da reti fidate durante orario lavorativo
http_access allow rete_aziendale metodo_post url_operazione orario_lavorativo
http_access allow rete_aziendale metodo_post url_operazione notte
http_access allow rete_aziendale metodo_post url_operazione fuori_orario
http_access allow rete_vpn metodo_post url_operazione orario_lavorativo
http_access allow rete_vpn metodo_post url_operazione notte
http_access allow rete_domestica metodo_post url_operazione orario_lavorativo

# Blocca POST verso /operazione fuori orario lavorativo
http_access deny !rete_aziendale metodo_post url_operazione fuori_orario
http_access deny rete_domestica metodo_post url_operazione notte
http_access deny rete_pubblica metodo_post url_operazione notte

# Consenti CONNECT solo da reti fidate verso SSL_ports
http_access allow rete_aziendale CONNECT SSL_ports
http_access allow rete_vpn CONNECT SSL_ports
http_access allow rete_domestica CONNECT SSL_ports
http_access deny CONNECT

# Blocco finale
http_access deny all

# === 7. Cache ===
cache_mem 256 MB
maximum_object_size_in_memory 8 MB
maximum_object_size 128 MB

# === 8. Logging ===
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log squid
